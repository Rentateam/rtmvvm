{% include 'header' %}

import Foundation
import RTMVVM

extension {{ module_info.name }} {
    class {{ custom_parameters.entity }}ViewModelSubscriber {
        private let engine: ViewModelSubscriberEngine<{{ module_info.name }}.{{ custom_parameters.entity }}ViewModel>
        private let factory: {{ module_info.name }}.{{ custom_parameters.entity }}ViewModelFactory
        
        init(factory: {{ module_info.name }}.{{ custom_parameters.entity }}ViewModelFactory) {
            self.factory = factory
            self.engine = ViewModelSubscriberEngine<{{ module_info.name }}.{{ custom_parameters.entity }}ViewModel>()
        }
        
        func addViewModel(model: {{ module_info.name }}.{{ custom_parameters.entity }}ViewModel) {
            self.engine.addViewModel(model: model)
        }
        
        private func rebuildViewModels() {
            self.engine.rebuildViewModels {
                self.factory.rebuild{{ custom_parameters.entity }}ViewModel(viewModel: $0)
            }
        }
    }
}
